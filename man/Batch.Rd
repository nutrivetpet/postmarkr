% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/batch.R
\name{Batch}
\alias{Batch}
\title{Batch Object - Collection of Email or Template Objects}
\usage{
Batch(messages = list(), chunk_size = 500L)
}
\arguments{
\item{messages}{List of \code{Email} or \code{Template} objects. All must be the same
class. Use \code{lapply()} or similar to create multiple messages programmatically.}

\item{chunk_size}{Integer scalar. Maximum messages per API call. Default is
500 (Postmark's limit). Set lower for testing (e.g., 50) or conservative
rate limiting (e.g., 100). Must be positive and not exceed 500.}
}
\description{
An S7 class representing a batch of email or template messages to be sent
via Postmark's batch API. This class handles chunking and validation
of multiple messages in a single operation.
}
\details{
The \code{Batch} class wraps a collection of messages (either \code{Email} or
\code{Template} objects) and manages the complexities of Postmark's batch API:

\itemize{
\item \strong{Homogeneity validation}: All messages must be the same type
(either all \code{Email} or all \code{Template})
\item \strong{Automatic chunking}: Splits large batches into API-compliant
chunks of 500 messages (Postmark's limit)
\item \strong{Type-agnostic design}: Works seamlessly with both message types
\item \strong{Configurable chunk size}: Allows smaller chunks for testing or
rate limiting
}

\strong{Batch API Endpoints:}
\itemize{
\item For \code{Email} messages: \verb{/email/batch}
\item For \code{Template} messages: \verb{/email/batchWithTemplates}
}

\strong{Important Limitations:}
\itemize{
\item Maximum 500 messages per API call (handled automatically via chunking)
\item Maximum 50 MB total payload size per chunk
\item Each message still subject to individual limits (50 recipients, 10 MB)
\item All messages in batch must be same type (Email or Template)
}
}
\examples{
\dontrun{
# Batch of regular emails (e.g., 1000 personalized emails)
emails <- lapply(1:1000, function(i) {
  Email(
    from = "sender@example.com",
    to = sprintf("user\%d@example.com", i),
    subject = sprintf("Welcome User \%d", i),
    html_body = sprintf("<p>Hello User \%d!</p>", i)
  )
})
batch <- Batch(messages = emails)

# Check batch metadata
cat(sprintf(
  "Batch contains \%d emails in \%d chunks\n",
  batch_size(batch),
  batch_chunk_count(batch)
))

# Send batch
client <- Postmarkr(token = "<token>", message_stream = "outbound")
result <- send(client, batch)

# Batch of template emails
recipients <- c("alice@example.com", "bob@example.com", "charlie@example.com")
templates <- lapply(recipients, function(email) {
  Template(
    from = "notifications@example.com",
    to = email,
    id = 12345678L,
    template_model = list(
      company_name = "ACME Corp"
    )
  )
})
batch <- Batch(messages = templates)
send(client, batch)
}

}
\seealso{
\itemize{
\item \url{https://postmarkapp.com/developer/api/email-api#send-batch-emails}
for Email batch API
\item \url{https://postmarkapp.com/developer/api/templates-api#send-batch-with-templates}
for Template batch API
\item \code{\link[=Email]{Email()}} for single email messages
\item \code{\link[=Template]{Template()}} for template-based messages
\item \code{\link[=send]{send()}} for sending batches
}
}
